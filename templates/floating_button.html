<style>
/* CSS styles for the floating button */
.floating-button {
    position: fixed;
    z-index: 1000; /* Ensure it's above other content */
    background-color: #007aff;
    color: white;
    border: none;
    border-radius: 50%;
    padding: 15px;
    font-size: 1.2em;
    cursor: pointer;
    box-shadow: 0 4px 10px rgba(0, 0, 0, 0.1);
}

.top-right {
    top: 20px; /* Adjust as needed */
    right: 20px; /* Adjust as needed */
}

.bottom-right {
    bottom: 20px; /* Adjust as needed */
    right: 20px; /* Adjust as needed */
}

/* CSS styles for the song list container */
.song-list-container {
    position: fixed;
    bottom: 20px; /* Adjust as needed */
    right: 80px; /* Adjust as needed */
    z-index: 999; /* Ensure it's below the floating button */
    background-color: white;
    border-radius: 10px;
    box-shadow: 0 4px 16px rgba(0,0,0,0.1);
    padding: 20px;
    display: none; /* Initially hidden */
    display: flex;
    flex-direction: column;
    align-items: center;
}

/* Center the h2 element */
.song-list-container h2 {
    text-align: center;
    width: 100%;
}

/* CSS styles for the unordered list */
.song-list-container ul {
    list-style: none; /* Remove default list styling */
    padding: 0; /* Remove default padding */
    margin: 0; /* Remove default margin */
    width: 100%; /* Make the list take the full width of the container */
    display: flex;
    flex-direction: column;
    align-items: center;
}

/* CSS styles for list items */
.song-list-item {
    margin-bottom: 10px;
    padding: 8px 12px;
    background-color: #f5f5f7;
    border-radius: 5px;
    cursor: pointer;
    display: flex;
    align-items: center;
    justify-content: space-between;
    width: 100%;
    max-width: 300px;
}

/* CSS styles for buttons inside the song list container */
.song-list-button {
    padding: 8px 12px;
    background-color: #007aff;
    color: white;
    border: none;
    border-radius: 5px;
    cursor: pointer;
    margin-left: 10px;
}

/* Center the buttons at the bottom */
.button-container {
    display: flex;
    justify-content: center;
    width: 100%;
    margin-top: 20px;
}

/* Dark mode styles */
.dark-mode {
    background-color: #121212;
    color: #e0e0e0;
}

.dark-mode a {
    color: #bb86fc;
}

/* Additional dark mode styles for other elements */
.dark-mode .top-right,
.dark-mode .bottom-right {
    background-color: #333;
    color: #fff;
}

.dark-mode .top-right:hover,
.dark-mode .bottom-right:hover {
    background-color: #555;
}

/* Additional dark mode styles for containers */
.dark-mode .song-list-container {
    background-color: #1f1f1f;
    box-shadow: 0 4px 16px rgba(0,0,0,0.2);
}

.dark-mode .song-list-container h2 {
    color: #fff;
}

.dark-mode .song-list-item {
    background-color: #333;
    color: #fff;
}

.dark-mode .song-list-button {
    background-color: #007aff;
    color: #fff;
}

.dark-mode .song-list-button:hover {
    background-color: #0056b3;
}

.dark-mode .floating-button {
    background-color: #333;
    color: #fff;
    box-shadow: 0 4px 10px rgba(0, 0, 0, 0.1);
}

/* Dark mode styles for lyrics container */
.dark-mode .lyrics-container{
    background-color: #121212;
    color: #e0e0e0;
    padding: 20px;
    border-radius: 10px;
    box-shadow: 0 4px 16px rgba(0,0,0,0.2);
}

.dark-mode .container {
    background-color: #121212;
    color: #e0e0e0;
    padding: 20px;
    border-radius: 10px;
    box-shadow: 0 4px 16px rgba(0,0,0,0.2);
}
/* Dark mode styles for lyrics container */
.dark-mode .container .song-list{
    background-color: #121212;
    color: #e0e0e0;
    padding: 20px;
    border-radius: 10px;
    box-shadow: 0 4px 16px rgba(0,0,0,0.2);
}

.dark-mode .container {
    background-color: #333;
    color: #fff;
    /* Additional styles as needed */
}


/* Dark mode styles for lyrics container */
.dark-mode .container .results-list{
    background-color: #121212;
    color: #e0e0e0;
    padding: 20px;
    border-radius: 10px;
    box-shadow: 0 4px 16px rgba(0,0,0,0.2);
}
/* Dark mode styles for lyrics container */
.dark-mode .container .artists-list{
    background-color: #121212;
    color: #e0e0e0;
    padding: 20px;
    border-radius: 10px;
    box-shadow: 0 4px 16px rgba(0,0,0,0.2);
}

.dark-mode .container .text-size-selector{
    background-color: #333;
    color: #e0e0e0;
    padding: 20px;
    border-radius: 10px;
    box-shadow: 0 4px 16px rgba(0,0,0,0.2);
}

.highlight {
            color: rgb(0, 0, 0);
        }
.dim {
    color: grey;
}

.dark-mode .highlight {
            color: white;
        }
.dark-mode .dim {
    color: grey;
}
</style>

<button id="darkModeButton" class="floating-button top-right">ðŸŒ™</button>
<button class="floating-button bottom-right" id="songListButton">ðŸ“’</button>

<div class="song-list-container" id="songListContainer">
    <h2>Your Song List</h2>
    <ul id="songList">
        <!-- Song list items will be dynamically added here -->
    </ul>
    <div class="button-container">
        <button id="shareButton" class="song-list-button">Export</button>
        <button id="importButton" class="song-list-button">Import</button>
    </div>
</div>

<script>
        // Function to add a song to the list
        function addSongToList(songId, songName, songUrl, skipUpdate = false) {
            const songList = document.getElementById('songList');

            // Extract path and query string after the domain
            const urlPath = new URL(songUrl).pathname + new URL(songUrl).search; // Include query parameters

            // Create list item for the song
            const listItem = document.createElement('li');
            listItem.className = 'song-list-item';
            listItem.setAttribute('data-id', songId); // Store song ID as a data attribute
            listItem.setAttribute('data-url-path', urlPath); // Store URL path with query parameters

            // Create element for song name
            const songNameElement = document.createElement('span');
            songNameElement.textContent = songName;
            songNameElement.className = 'song-name';

            // Create remove button
            const removeButton = document.createElement('button');
            removeButton.textContent = 'Remove';
            removeButton.className = 'song-list-button remove-button';
            removeButton.addEventListener('click', function(event) {
                event.stopPropagation(); // Prevent navigation when clicking remove button
                listItem.remove();
                updateLocalStorage(); // Update local storage after removing a song
            });

            // Append song name and remove button to list item
            listItem.appendChild(songNameElement);
            listItem.appendChild(removeButton);

            // Add click event to navigate to lyrics page
            songNameElement.addEventListener('click', function(event) {
                event.stopPropagation(); // Prevent remove button click event
                const fullUrl = `${window.location.origin}${urlPath}`; // Construct the full URL with the current domain
                window.location.href = fullUrl; // Use the constructed URL
            });

            // Append the list item to the song list
            songList.appendChild(listItem);

            if (!skipUpdate) {
                updateLocalStorage(); // Update local storage after adding a song
            }
        }



        // Function to update local storage with current song list
        function updateLocalStorage() {
            console.log("Updating local storage");
            const songList = document.getElementById('songList');
            const songItems = songList.querySelectorAll('.song-list-item');
            const songs = [];

            songItems.forEach(item => {
                const songId = item.getAttribute('data-id');
                const songName = item.querySelector('.song-name').textContent.trim();
                const urlPath = item.getAttribute('data-url-path'); // Retrieve the URL path with query parameters

                // Check if songId, songName, and urlPath are valid before adding to array
                if (songId && songName && urlPath) {
                    songs.push({ id: songId, name: songName, urlPath: urlPath });
                }
            });

            console.log("Saving songs to local storage:", songs);
            localStorage.setItem('songList', JSON.stringify(songs)); // Set local storage with song list
        }



    // Wait for DOM content to load before executing
    document.addEventListener('DOMContentLoaded', function() {
        const songListButton = document.getElementById('songListButton');
        const songListContainer = document.getElementById('songListContainer');
        const shareButton = document.getElementById('shareButton');
        const removeSelectedButton = document.getElementById('removeSelectedButton');

        const darkModeButton = document.getElementById('darkModeButton');
        const darkModeClass = 'dark-mode';

        // Load the dark mode preference from localStorage
        if (localStorage.getItem('darkMode') === 'enabled') {
            document.body.classList.add(darkModeClass);
        }

        // Toggle dark mode
        darkModeButton.addEventListener('click', () => {
            document.body.classList.toggle(darkModeClass);

            // Save the preference to localStorage
            if (document.body.classList.contains(darkModeClass)) {
                localStorage.setItem('darkMode', 'enabled');
            } else {
                localStorage.removeItem('darkMode');
            }
        });
        // Toggle song list container visibility
        songListButton.addEventListener('click', function() {
            songListContainer.style.display = songListContainer.style.display === 'none' ? 'block' : 'none';
        });

        // Share button functionality to download the song list as JSON and provide instructions for emailing
        shareButton.addEventListener('click', function() {
            const songList = document.getElementById('songList');
            const songItems = songList.querySelectorAll('.song-list-item');
            const songs = [];

            songItems.forEach(item => {
                const songId = item.getAttribute('data-id');
                const songName = item.querySelector('.song-name').textContent.trim();
                if (songId && songId !== 'undefined') {
                    songs.push({ id: songId, name: songName });
                }
            });

            const jsonContent = JSON.stringify(songs, null, 2); // Create formatted JSON string
            const blob = new Blob([jsonContent], { type: 'application/json' });
            const url = URL.createObjectURL(blob);

            // Create a temporary link element
            const link = document.createElement('a');
            link.href = url;
            link.download = 'song_list.json';
            document.body.appendChild(link);
            link.click();
            document.body.removeChild(link);

            // Instructions for the user to email the downloaded file
            alert('The song list has been downloaded as a JSON file. Please attach the file to your email manually.');
        });


        importButton.addEventListener('click', function() {
        const input = document.createElement('input');
        input.type = 'file';
        input.accept = 'application/json';

        input.onchange = function(event) {
            const file = event.target.files[0];
            if (!file) return;

            const reader = new FileReader();
            reader.readAsText(file);

            reader.onload = function(event) {
                const content = event.target.result;
                try {
                    const songs = JSON.parse(content);
                    clearSongListContainer(); // Clear existing song list
                    songs.forEach(song => {
                        addSongToList(song.id, song.name); // Add songs to the list
                    });
                    updateLocalStorage(); // Update local storage with imported songs
                } catch (error) {
                    alert('Error importing song list.');
                    console.error('Error importing song list:', error);
                }
            };
        };

        input.click(); // Trigger file input dialog
    });




        // Function to load songs from local storage
        function loadFromLocalStorage() {
            const songListStr = localStorage.getItem('songList');
            console.log("Loading songs from local storage:", songListStr);

            if (songListStr) {
                const songs = JSON.parse(songListStr);
                songs.forEach(song => {
                    const songUrl = `${window.location.origin}${song.urlPath}`; // Reconstruct the full URL with the current domain
                    addSongToList(song.id, song.name, songUrl, true); // Use song.id, song.name, and songUrl from local storage, skip update
                });
            }
        }





        // Function to get song ID from URL
        function getSongIdFromUrl() {
            const pathArray = window.location.pathname.split('/');
            return pathArray[pathArray.length - 1]; // Assuming song ID is the last part of the URL
        }

        // Function to handle adding a song from lyrics page
        function handleAddSongFromLyricsPage() {
            const songId = getSongIdFromUrl(); // Get song ID from current URL
            const songName = document.querySelector('h1').textContent.trim(); // Get song name from <h1> tag
            const songUrl = window.location.href; // Use current page URL as the song URL

            // Add current song to the list only if it's not already there
            if (songId && songName && songUrl && !isCurrentSongInList(songId)) {
                addSongToList(songId, songName, songUrl);
            } else if (isCurrentSongInList(songId)) {
                alert("Song is already in the list.");
            }
        }


        // Function to check if the current song is in the list
        function isCurrentSongInList(songId) {
            const songList = document.getElementById('songList');
            const songItems = songList.querySelectorAll('.song-list-item');
            let isInList = false;

            songItems.forEach(item => {
                const id = item.getAttribute('data-id');
                if (id === songId) {
                    isInList = true;
                }
            });

            return isInList;
        }

        // Function to clear the song list container
        function clearSongListContainer() {
            const songList = document.getElementById('songList');
            while (songList.firstChild) {
                songList.removeChild(songList.firstChild);
            }
        }

        // Function to reload the song list container from local storage
        function reloadSongListContainer() {
            clearSongListContainer();
            loadFromLocalStorage();
        }

        loadFromLocalStorage(); // Load songs from local storage on page load
        // Bind handleAddSongFromLyricsPage to + button click on lyrics page
        const addButton = document.getElementById('addButton'); // Replace with actual ID or selector of the + button
        if (addButton) {
            addButton.addEventListener('click', function() {
                reloadSongListContainer();
                handleAddSongFromLyricsPage();
                reloadSongListContainer();
            });
        }
    });
</script>
